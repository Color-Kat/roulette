<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Рулетка</title>

    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-200">  
    <header class="text-slate-800 shadow-md mb-4 h-16 flex items-center justify-center text-3xl font-semibold bg-slate-100"><h1>Рулетка.online</h1></header>
    <div class="page bg-slate-100 rounded-lg shadow-lg max-w-lg m-auto p-6">
        <section class="description text-lg border-b-2 pb-2">
            Наша рулетка - самое белое казино. Об этом свидетельствует дизайн сайта)
        </section>

        <section class="roulette flex justify-center items-center my-4" width="500" height="500">
            <button
                id="spin-btn"
                class="
                    absolute z-10 bg-slate-100 w-20 h-20 rounded-full
                    text-3xl text-center flex items-center justify-center
            ">&#8635;</button>
            <canvas id="roulette" width="500" height="500" class="">В вашем браузере запрещено играть в рулетку!</canvas>
        </section>
    </div>

    <script>

        const colors = [
            "#B8D430", "#3AB745", "#029990", "#3501CB",
            "#2E2C75", "#673A7E", "#CC0071", "#F80120",
            "#F35B20", "#FB9A00", "#FFCC00", "#FEF200"
        ];

        const prizes = [
            "Wendy's", "McDonalds", "Chick-fil-a", "Five Guys",
            "Gold Star", "La Mexicana", "Chipotle", "Tazza Mia",
            "Panera", "Just Crepes", "Arby's", "Indian"
        ];

        // Настройки
        let wheelSize = 480;
        let prizesCount = prizes.length;
        let arc = 2 * Math.PI / prizesCount; // 2PI - единичная окр. Находим длину одной дуги сектора в радианах

        let canvas, w, h, ctx;

      

        const drawRouletteWheel = () => {
            h = canvas.height;
            w = canvas.width;
            ctx = canvas.getContext('2d');
        
            ctx = canvas.getContext("2d");
            ctx.clearRect(0,0,w,h);
   
            ctx.strokeStyle = "black";
            ctx.lineWidth = 2;

            ctx.font = 'bold 20px Helvetica, Arial';
        
            for(let i = 0; i < prizesCount; i++) {
                let angle = i * arc; // Находим угол в радианах, на который нужно сдвинуть следующий сектор
                ctx.fillStyle = colors[i]; // Выбираем цвет сектора
                
                // ОТРИСОВЫВАЕМ СЕКТОР
                ctx.beginPath();
                ctx.arc(w/2, h/2, wheelSize/2, angle, angle + arc, false);
                ctx.lineTo(w/2, h/2);
                ctx.stroke();
                ctx.fill();

                ctx.save(); // Сохраняем текущие состояния, настройки ctx

                // ОТРИСОВЫВАЕМ ТЕКСТ
                ctx.shadowOffsetX = -1;
                ctx.shadowOffsetY = -1;
                ctx.shadowBlur    = 0;
                ctx.shadowColor   = "rgb(220,220,220)";
                ctx.fillStyle = "black";

                ctx.translate(w/2, h/2); // Перемещаем центр координат в центр окружности
                ctx.rotate(angle + arc/2); // Поворачиваем холст на угол, под которые наклонён сектр
                let text = prizes[i]; // Выбираем текст сектора
                ctx.textAlign = "right"; // Выравниваем текст по правому краю, чтобы отрисовывать его, начиная с края окружности
                ctx.fillText(text, wheelSize/2 -30, 9); // Отрисовываем текст с отступом от края окружности

                ctx.restore(); // Восстанавливаем ctx состояние для сектора
            }

            ctx.beginPath();
            ctx.fillStyle = "red";
            ctx.moveTo(w - 24, h/2);
            ctx.lineTo(w, h/2 - 12);
            ctx.lineTo(w, h/2 + 12);
            ctx.fill();
        }

        
        function rand(min, max) { // min and max included 
            return Math.floor(Math.random() * (max - min + 1) + min)
        }

        function toRad(deg){
            return deg * (Math.PI/180);
        }

        let currentDeg = 0;
        const rotate = () => {
            let spinDeg = rand(2802, 7198);
            currentDeg += spinDeg;
            // let time = Math.round(rand(7,11));
            let time = Math.round(rand(2,3));
            canvas.style.transition = `all ${time}s cubic-bezier(.09,.16,.3,1.06)`;
            canvas.style.transform  = 'rotate('+currentDeg+'deg)'; 

            setTimeout(() => {
                const rad = toRad(currentDeg);
                console.log(currentDeg, rad);


            }, time*1000);
        }

        window.addEventListener('load', () => {
            canvas = document.querySelector('#roulette');
            drawRouletteWheel(); // Рисуем колесо

            const spinBtn = document.querySelector('#spin-btn');
            spinBtn.addEventListener('click', () => {
                rotate();
            });
        });
    </script>
</body>
</html>